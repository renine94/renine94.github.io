---
layout: single

header:
  teaser: /assets/images/logo/spring.png
  overlay_image: /assets/images/logo/spring.png
  overlay_filter: linear-gradient(rgba(255, 0, 0, 0.5), rgba(0, 255, 255, 0.5))
  caption: "Photo credit: [**Unsplash**](https://unsplash.com)"
  actions:
    - label: "Github"
      url: "https://github.com/renine94"

title: "[spring] ìŠ¤í”„ë§ JPA ê°ì²´ì§€í–¥ ì¿¼ë¦¬ì–¸ì–´ JPQL - ì„œë¸Œì¿¼ë¦¬ & íƒ€ì…í‘œí˜„"
excerpt: "ğŸš€ spring, JPA, JPQL, SubQuery, ì„œë¸Œì¿¼ë¦¬, íƒ€ì…í‘œí˜„"

categories: spring
tag: [spring, model, jpa, jpql, subquery]

toc: true
toc_label: "ğŸ“• ëª©ì°¨"
toc_icon: "null"
toc_sticky: true

sidebar:
  nav: "docs"


---

# ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´5 - SubQuery & íƒ€ì…í‘œí˜„

- ì†Œê°œ
- ê¸°ë³¸ ë¬¸ë²•ê³¼ ì¿¼ë¦¬API
- í”„ë¡œì ì…˜(SELECT)
- í˜ì´ì§•
- ì¡°ì¸
- **ì„œë¸Œ ì¿¼ë¦¬**
- **JPQL íƒ€ì… í‘œí˜„ê³¼ ê¸°íƒ€ì‹**
- ì¡°ê±´ì‹ (CASE ë“±ë“±)
- JPQL í•¨ìˆ˜

<br><br>

## 01. SubQuery

- ë‚˜ì´ê°€ í‰ê· ë³´ë‹¤ ë§ì€ íšŒì›

  ```sql
  SELECT m
  FROM Memberm m
  WHERE m.age > (
  	SELECT avg(m2.age)
    FROM Member m2
  )
  ```



- í•œ ê±´ì´ë¼ë„ ì£¼ë¬¸í•œ ê³ ê°

```sql
SELECT m
FROM Member m
WHERE (
	SELECT count(o)
  FROM Order o
  WHERE m = o.member
) > 0
```



- ì–´ë–¤ íŒ€ì´ë“  íŒ€ì— ì†Œì†ëœ íšŒì›

```sql
SELECT m
FROM Member m
WHERE m.team = ANY (SELECT t FROM Team t)
```



## 02. JPA ì„œë¸Œì¿¼ë¦¬ í•œê³„

- JPAëŠ” Where, Having ì ˆì—ì„œë§Œ ì„œë¸Œ ì¿¼ë¦¬ ê°€ëŠ¥
- SELECT ì ˆë„ ê°€ëŠ¥ (í•˜ì´ë²„ë„¤ì´íŠ¸ ì§€ì›)
- **FROM ì ˆì˜ ì„œë¸Œ ì¿¼ë¦¬ëŠ” í˜„ì¬ JPQLì—ì„œ ë¶ˆê°€ëŠ¥**
  - **ì¡°ì¸ìœ¼ë¡œ í’€ ìˆ˜ ìˆìœ¼ë©´ í’€ì–´ì„œ í•´ê²°**



---



## 03. JPQL íƒ€ì… í‘œí˜„

- ë¬¸ì
  - 'Hello', 'She"s'
- ìˆ«ì
  - 10L (Long)
  - 10D (Double)
  - 10F (Float)
- Boolean
  - TRUE
  - FALSE
- ENUM
  - jpabook.MemberType.Admin (íŒ¨í‚¤ì§€ëª… í¬í•¨)
- ì—”í‹°í‹° íƒ€ì…
  - TYPE(m) = Member (ìƒì† ê´€ê³„ì—ì„œ ì‚¬ìš©)



```java
@Entity
public class Member {
  
  @Id @GeneratedValue
  private Long id;
  private String username;
  private int age;
  
  @ManyToOne(fetch = FetchType.LAZY)
  @JoinCOlumn(name = "TEAM_ID")
  private Team team;
  
  @Enumerated(EnumType.STRING) 
  private MemberType type;  // ì´ ë¶€ë¶„
}


Member member = new Member();
member.setUsername("teamA");
member.setAge(10);
member.setType(MemberType.ADMIN);

// íƒ€ì…ì€ íŒ¨í‚¤ì§€ëª…ê¹Œì§€ í¬í•¨í•´ì„œ ì¡°íšŒí•´ì•¼ í•œë‹¤.
String query = "select m.username, 'HELLO', true, from Member m " +
  						"where m.type = jpql.MemberType.ADMIN";

// íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ìœ¼ë¡œ ë™ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ë©´ íŒ¨í‚¤ì§€ëª…ì„ ëª¨ë‘ ì ì„ í•„ìš”ê°€ ì—†ë‹¤.
String query = "select m.username, 'HELLO', true, from Member m " +
  						"where m.type = :userType";

List<Object[]> result = em.createQuery(query)
  .setParameter("userType", MemberType.ADMIN)
  .getResultList();


```















































